{% raw %}<div class="related">
  <h3>Posts Relacionados</h3>
  {% assign max_related = 5 %}
  {% assign min_common_tags = 1 %}
  {% assign related_posts = '' | split: '' %}

  {% for post in site.posts %}
    {% assign common_tags = 0 %}
    {% for tag in post.tags %}
      {% if page.tags contains tag %}
        {% assign common_tags = common_tags | plus: 1 %}
      {% endif %}
    {% endfor %}

    {% if common_tags >= min_common_tags %}
      {% unless post.url == page.url %}
        {% assign related_posts = related_posts | push: post %}
      {% endunless %}
    {% endif %}
  {% endfor %}

  {% assign sorted_related_posts = related_posts | sort: 'tags.size' | reverse %}

  <ul class="related-posts">
    {% for post in sorted_related_posts limit:max_related %}
      <li>
        <a href="{{ site.baseurl }}{{ post.url }}">
          {{ post.title }}
        </a>
        <small>({{ post.date | date: "%d/%m/%Y" }})</small>
      </li>
    {% endfor %}
  </ul>
</div>{% endraw %}